{% extends 'base.html' %}
<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    {% block head %}
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport" maximum-scale=1.0, user-scalable=0”>
    <title></title>
    <link rel="icon" type="image/ico" href="/static/favicon.ico">
    <link rel="shortcut icon" type="image/ico" href="/static/favicon.ico">
    <!-- sunnylogin -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"/>
    <!-- <link href='/static/css/table-fixed-header.css' rel='stylesheet' /> -->
    <link href="/static/css/tabdrop.css" rel="stylesheet">
    <!-- <script src="/static/js/jquery-1.7.2.min.js"></script> -->
    <!-- <script src='/static/js/table-fixed-header.js'></script> -->
    <!-- <script src="/static/js/index.js"></script> -->
    <!-- <script src="/static/js/bootstrap-dropdown.js"></script> -->
    <!-- <script src="/static/js/bootstrap-tab.js"></script> -->
    <!-- <script src="/static/js/bootstrap-tabdrop.js"></script> -->
    <style>
        @keyframes spinning {
            0% { transform: rotateZ(0deg);}
            90% { transform: rotateZ(720deg);}
            100% { transform: rotateZ(720deg);}
        }
        
        .loadingData{
            width: 50px;
            height: 50px;
            margin: auto;
            position: relative;
        }

        .loadingData > span{
            display: block;
            position: absolute;
            width: 36px;
            height: 36px;
            border-width: 5px;
            border-radius: 50%;
            border-style: solid;
            border-color: #007bff transparent transparent transparent;
        }

        .loadingData > span:nth-child(1){
            animation: spinning 3s ease-in-out 0s infinite;
        }
        .loadingData > span:nth-child(2){
            animation: spinning 3s ease-in-out 0.15s infinite;
        }
        .loadingData > span:nth-child(3){
            animation: spinning 3s ease-in-out 0.3s infinite;
        }
        .loadingData > span:nth-child(4){
            animation: spinning 3s ease-in-out 0.45s infinite;
        }
    </style>
    {% endblock %}
</head>

<body>
    {% block body %}
    <div id="vue_app" class="cont">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="/v_search/land_dev/">
                    <img src="#logo.png" class="img-fluid">
                </a>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item bi"><a href="/v_search/land_dev/">土地開發</a></li>
                    </ol>
                </nav>
            </div>
            <div class="d-flex5">
                <a href="#" type="button" class="btn dropdown-toggle w-150" data-toggle="dropdown" aria-expanded="false">
                    {% if user.first_name == '' %}
                    {{ user.username }}
                    {% else %}
                    {{ user.first_name }}
                    {% endif %}
                    <svg  class="svg5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"></path></svg>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li class="">
                        <a href="/v_search/member_pw/" class="btn dropdown-item">
                            變更密碼
                        </a>
                    </li>
                    <li class="tmp">
                        <a href="/v_search/member_aclist/" class="btn dropdown-item">
                            帳號管理
                        </a>
                    </li>
                    <li>
                        <a href="#" id="buttonForLogout" class="btn dropdown-item" @click="logout()">
                            登出
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="container wrap">
            <nav aria-label="breadcrumb" class="bb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">首頁</a></li>
                    <li class="breadcrumb-item" :class="{active: !showResult}" :style="showResult ? 'cursor: pointer': ''" @click="showResult=0">土地開發</li>
                    <li class="breadcrumb-item active" v-if="showResult">搜尋結果</li>
                </ol>
            </nav>
            <div class="tabbable ">
                <ul class="nav nav-tabs">
                    <li v-for="(txt, idx) in setOption" :class="{active: useSet==idx}"><a href="#" @click="setForm(idx)">(( txt ))</a></li>
                </ul>
                <div class="tab-content">
                    <div class="row r1">
                        <div class="row rwd1">
                            <label class="col-form-label w-80 text-center1" for="edit-text-name-id">搜尋</label>
                            <!--縣市-->
                            <div class="col w-200">
                                <select class="form-control custom-select col-sm-12 w-10 width98" v-model="searchForm.land.region.city" @change="getArea(searchForm.land.region.city)">
                                    <option :value="null" selected>縣市</option>
                                    <option :value="key" v-for="(value, key) in cityList"> ((value)) </option>
                                </select>
                            </div>
                            <!--行政區-->
                            <div class="col w-200">
                                <select class="form-control custom-select col-sm-12 w-10 width98" v-model="searchForm.land.region.area" @change="getSection(searchForm.land.region.area), getPlan(searchForm.land.region.area)">
                                    <option :value="null" selected>行政區</option>
                                    <option :value="key" v-for="(value, key) in areaList[searchForm.land.region.city]"> ((value)) </option>
                                </select>
                            </div>
                            <!--段小段-->
                            <div class="col w-200">
                                <select class="form-control custom-select col-sm-12 w-10 width98" v-model="searchForm.land.region.section" @change="searchForm.land.region.plan=null">
                                    <option :value="null" selected>段小段</option>
                                    <option :value="key" v-for="(value, key) in sectionList[searchForm.land.region.area]"> ((value)) </option>
                                </select>
                            </div>
                            <!--計劃案-->
                            <div class="col w-200">
                                <select class="form-control custom-select col-sm-12 w-10 width98" v-model="searchForm.land.region.plan" @change="searchForm.land.region.section=null">
                                    <option :value="null" selected>計劃案</option>
                                    <option :value="key" v-for="(value, key) in planList[searchForm.land.region.area]"> ((value)) </option>
                                </select>
                            </div>
                            <!--地號-->
                            <div class="col w-200">
                                <div class="width98">
                                    <input class="form-control" :class="{'is-invalid': !landbuildNumberFix(searchForm.land.region.land_number, 'l').ok}" placeholder="地號" v-model="searchForm.land.region.land_number">
                                </div>
                                <div class="dropdown d-none">
                                    <button class="btn dropdown-toggle custom-select left" type="button"
                                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        地號
                                    </button>
                                    <div class="dropdown-menu">
                                        <form class="px-4 py-3 row pp">
                                            <div class="form-check col-sm-12 pp2">
                                                <input class="form-control" :class="{'is-invalid': !landbuildNumberFix(searchForm.land.region.land_number, 'l').ok}" placeholder="地號" v-model="searchForm.land.region.land_number">
                                            </div>
                                            <div class="form-group col-sm-6">
                                            </div>
                                            <div class="form-group col-sm-6 pp1 d-none">
                                                <input type="checkbox" class="form-check-input" id="dropdownCheck" v-model="searchForm.land.region.includeInvalid">
                                                <label class="form-check-label" for="dropdownCheck">包含失效資料</label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!--使用分區-->
                            <div class="col w-200">
                                <div class="dropdown width98">
                                    <button class="btn dropdown-toggle custom-select on on1 left" type="button" data-toggle="dropdown">
                                        使用分區
                                    </button>
                                    <ul class="dropdown-menu" @click.stop>
                                        <li class="dropright">
                                            <button class="dropdown-item" type="button" @click="clearInOutCitty()">不拘</button>
                                        </li>
                                        <li class="dropright">
                                            <button class="dropdown-item" type="button">
                                                <input type="checkbox" class="form-check-input" id="road" v-model="searchForm.land.condition.road_land">
                                                <label class="m-0 w-100" for="road">道路用地</label>
                                            </button>
                                        </li>
                                        <li class="dropright">
                                            <button class="dropdown-item" type="button">
                                                <input type="checkbox" class="form-check-input" id="reserve" v-model="searchForm.land.condition.common_land">
                                                <label class="m-0 w-100" for="reserve">公共設施保留地</label>
                                            </button>
                                        </li>
                                        <li class="dropright">
                                            <button class="dropdown-item dropdown-toggle" type="button" data-toggle="dropdown" @click="bootstrapSubMenuToggle($event)">都內</button>
                                            <div id="inCity" class="dropdown-menu dropdown-submenu dmshow1 rwd2">
                                                <button class="dropdown-item" type="button" v-for="(i, idx) in inCity">
                                                    <input type="checkbox" class="form-check-input" :id="'inCity' + idx" v-model="searchForm.land.condition.inCity[i]">
                                                    <label class="m-0 w-100" :for="'inCity' + idx">(( i ))</label>
                                                </button>
                                            </div>
                                        </li>
                                        <li class="dropright dropdown-submenu">
                                            <button class="dropdown-item dropdown-toggle" type="button" data-toggle="dropdown" @click="bootstrapSubMenuToggle($event)">都外</button>
                                            <div id="outCity" class="dropdown-menu rwd2">
                                                <div class="dropdown dropright dropdown-submenu">
                                                    <button class="dropdown-item dropdown-toggle" type="button" @click="bootstrapSubMenuToggle($event)">使用分區</button>
                                                    <div class="dropdown-menu rwd3">
                                                        <button class="dropdown-item" type="button" v-for="(i, idx) in outCity">
                                                            <input type="checkbox" class="form-check-input" :id="'outCity' + idx" v-model="searchForm.land.condition.outCity[i]">
                                                            <label class="m-0 w-100" :for="'outCity' + idx">(( i ))</label>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="dropdown dropright dropdown-submenu">
                                                    <button class="dropdown-item dropdown-toggle" type="button" @click="bootstrapSubMenuToggle($event)">使用地類別</button>
                                                    <div class="dropdown-menu dmshow1 rwd3">
                                                        <button class="dropdown-item" type="button" v-for="(i, idx) in outCity2">
                                                            <input type="checkbox" class="form-check-input" :id="'outCity2' + idx" v-model="searchForm.land.condition.outCity2[i]">
                                                            <label class="m-0 w-100" :for="'outCity2' + idx"p>(( i ))</label>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!--土地面積-->
                            <div class="col w-200 w-as">
                                <div class="dropdown  width98">
                                    <button class="btn dropdown-toggle custom-select on1 left" type="button"
                                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        土地面積
                                    </button>
                                    <div class="dropdown-menu">
                                        <form class="p3 pp row">
                                            <div class="col-sm-6">
                                                <select class="form-control custom-select col-sm-12 w-10" v-model="searchForm.land.condition.areaType">
                                                    <option :value="idx" v-for="(i, idx) in areaTypeList">(( i ))</option>
                                                </select>
                                            </div>
                                            <div class="row v4">
                                                <input type="" class="form-control col-sm-3 v2" placeholder="0" v-model="searchForm.land.condition.landAreaLowerLimit">
                                                <label class="col-form-label la1" for="edit-text-name-id">坪-</label>
                                                <input type="" class="form-control col-sm-3 v2" placeholder="0" v-model="searchForm.land.condition.landAreaUpperLimit">
                                                <label class="col-form-label la1" for="edit-text-name-id">坪</label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!--按鈕-->
                            <div class="col w-80 float-end right2">
                                <button class="btn btn1 w-81 btn002" data-toggle="collapse" href="#collapseExample"
                                    role="button" aria-expanded="false" aria-controls="collapseExample">
                                    進階
                                </button>
                            </div>
                            <div class="rwdad"></div>
                            <div class="colrwd cw-125 float-end right1">
                                <button type="button" class="btn btn-primary btn001" @click="serverSearch()" :disabled="loading"><svg class="w-ab" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0z" fill="none"/>
                                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                                </svg>搜尋</button>
                            </div>
                            <!--END-->
                        </div>
                        <!--進階選項-->
                        <div class="collapse r2" id="collapseExample">
                            <div class="card card-body">
                                <div class="row row-cols-auto row1">
                                    <label class="col-form-label w-80 text-center1" for="edit-text-name-id">使用狀況</label>
                                    <!--權屬-->
                                    <!--FK-->
                                    <div class="w-200">
                                        <button type="button" class="dropdown-toggle custom-select text-center text-truncate" data-toggle="dropdown" style="width: 100%;" aria-expanded="false">
                                            <span class="text-nowrap">(( searchFormText.land.condition.ownership ))</span>
                                        </button>
                                        <div class="dropdown-menu">
                                            <button v-for="(v, k) in ownerShopList" @click.stop class="dropdown-item" :class="{'active': searchForm.land.condition.ownership[k]}">
                                                <span class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="natural" :id="'ownership'+k" v-model="searchForm.land.condition.ownership[k]">
                                                    <label class="form-check-label" :for="'ownership'+k">(( v ))</label>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <!--持分-->
                                    <div class="w-200">
                                        <select id="bs2" class="f1 form-select custom-select col-sm-12 w-10" v-model="searchForm.land.condition.ownershipType">
                                            <option :value="null">持分</option>
                                            <option :value="0">全部</option>
                                            <option :value="1">持分</option>
                                            <option :value="2">公同共有</option>
                                        </select>
                                    </div>
                                    <!--登記原因-->
                                    <!--FK-->
                                    <div class="w-200">
                                        <button type="button" class="dropdown-toggle custom-select text-center text-truncate" data-toggle="dropdown" style="width: 100%;" aria-expanded="false">
                                            <span class="text-nowrap">(( searchFormText.land.condition.registerReason ))</span>
                                        </button>
                                        <div class="dropdown-menu">
                                            <button v-for="(v, k) in registerReasonList" @click.stop class="dropdown-item" :class="{'active': searchForm.land.condition.registerReason[k+1]}">
                                                <span class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="natural" :id="'registerReason'+k" v-model="searchForm.land.condition.registerReason[k+1]">
                                                    <label class="form-check-label" :for="'registerReason'+k">(( v ))</label>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <!--持有年限-->
                                    <div class="w-200">
                                        <div class="dropdown on1">
                                            <button class="btn dropdown-toggle custom-select left" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                持有年限
                                            </button>
                                            <div class="dropdown-menu p3 pp row">
                                                <div class="col-sm-6">
                                                    <select class="form-control custom-select col-sm-12 w-10" v-model="searchForm.land.other.holding_period">
                                                        <option :value="'[' + (searchForm.land.other.holding_period_l*12) + ',' + (searchForm.land.other.holding_period_u*12) + ']'">自訂</option>
                                                        <option value="[0,6]">半年內</option>
                                                        <option value="[0,12]">1年內</option>
                                                        <option value="[36,60]">3 ~ 5年內</option>
                                                        <option value="[60,120]">5 ~ 10年內</option>
                                                        <option value="[120,]">10 年以上</option>
                                                    </select>
                                                </div>
                                                <div class="row v4">
                                                    <input class="form-control col-sm-3 v2" placeholder="0" v-model="searchForm.land.other.holding_period_l" v-number="0">
                                                    <label class="col-form-label la1" for="edit-text-name-id">年-</label>
                                                    <input class="form-control col-sm-3 v2" placeholder="0" v-model="searchForm.land.other.holding_period_u" v-number="0">
                                                    <label class="col-form-label la1" for="edit-text-name-id">年</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--國土區分-->
                                    <!--FK-->
                                    <div class="w-200">
                                        <button type="button" class="dropdown-toggle custom-select text-center text-truncate" data-toggle="dropdown" style="width: 100%;" aria-expanded="false">
                                            <span class="text-nowrap">(( searchFormText.land.region.national_land_zone ))</span>
                                        </button>
                                        <div class="dropdown-menu">
                                            <button v-for="(v, k) in national_land_zoneList" @click.stop class="dropdown-item" :class="{'active': searchForm.land.region.national_land_zone[k]}">
                                                <span class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="natural" :id="'national_land_zone'+k" v-model="searchForm.land.region.national_land_zone[k]">
                                                    <label class="form-check-label" :for="'national_land_zone'+k">(( v ))</label>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <!--地上建物-->
                                    <!--FK-->
                                    <div class="w-200">
                                        <button type="button" class="dropdown-toggle custom-select text-center text-truncate" data-toggle="dropdown" style="width: 100%;" aria-expanded="false">
                                            <span class="text-nowrap">地上建物</span>
                                        </button>
                                        <div class="dropdown-menu">
                                            <div class="row v4">
                                                <input class="form-control col-sm-3 v2" placeholder="0" v-model="searchForm.land.region.landbuildLowerLimit" v-number="0">
                                                <label class="col-form-label la1" for="edit-text-name-id">~</label>
                                                <input class="form-control col-sm-3 v2" placeholder="0" v-model="searchForm.land.region.landbuildUpperLimit" v-number="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--面積價值-->
                                <div class="row row-cols-auto row1">
                                    <label class="col-form-label w-80 text-center1" for="edit-text-name-id">面積價值</label>
                                    <div class="w-200">
                                        <div class="dropdown">
                                            <button class="btn dropdown-toggle  custom-select left" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                公告現值
                                            </button>
                                            <div class="dropdown-menu">
                                                <form class="p3 pp">
                                                    <div class="row pp2 v5">
                                                        <input type="" class="form-control col-sm-2 v2" placeholder="0" v-model="searchForm.land.condition.presentLowerLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">萬-</label>
                                                        <input type="" class="form-control col-sm-2 v2" placeholder="0" v-model="searchForm.land.condition.presentUpperLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">萬</label>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <!--僱人持分總值-->
                                    <div class="w-200">
                                        <div class="dropdown">
                                            <button class="btn dropdown-toggle  custom-select left" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                個人持分總值
                                            </button>
                                            <div class="dropdown-menu">
                                                <form class="p3 pp">
                                                    <div class="pp2 row v5">
                                                        <input type="" class="form-control col-sm-2" placeholder="0" v-model="searchForm.land.other.p_part_valueLowerLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">萬-</label>
                                                        <input type="" class="form-control col-sm-2" placeholder="0" v-model="searchForm.land.other.p_part_valueUpperLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">萬</label>
        
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <!--個人持分總面積-->
                                    <div class="w-200 d-none">
                                        <div class="dropdown">
                                            <button class="btn dropdown-toggle  custom-select left" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                個人持分總面積
                                            </button>
                                            <div class="dropdown-menu">
                                                <form class="p3 pp">
                                                    <div class="pp2 row v5">
                                                        <input type="" class="form-control col-sm-2" placeholder="0" v-model="searchForm.land.other.p_part_areaLowerLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">坪-</label>
                                                        <input type="" class="form-control col-sm-2" placeholder="0" v-model="searchForm.land.other.p_part_areaUpperLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">坪</label>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--所有權人-->
                                <div class="row row-cols-auto row1">
                                    <label class="col-form-label w-80 text-center1" for="edit-text-name-id">所有權人</label>
                                    <div class="w-200">
                                        <script type="text/javascript">
                                            $('#example-single').multiselect();
                                        </script>
                                        <select id="example-single" class="form-select custom-select col-sm-12 w-10" v-model="searchForm.land.other.age_range">
                                            <option :value="key" v-for="(value, key) in age_range_list">(( value ))</option>
                                        </select>
                                    </div>
                                    <!--國籍-->
                                    <!--FK-->
                                    <div class="w-200">
                                        <button type="button" class="dropdown-toggle custom-select text-center text-truncate" data-toggle="dropdown" style="width: 100%;" aria-expanded="false">
                                            <span class="text-nowrap">(( searchFormText.land.other.country ))</span>
                                        </button>
                                        <div class="dropdown-menu">
                                            <button v-for="(v, k) in country_list" @click.stop class="dropdown-item" :class="{'active': searchForm.land.other.country[k]}">
                                                <span class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="natural" :id="'country'+k" v-model="searchForm.land.other.country[k]">
                                                    <label class="form-check-label" :for="'country'+k">(( v ))</label>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <!--所有權人數-->
                                    <div class="w-200">
                                        <div class="dropdown">
                                            <button class="btn dropdown-toggle  custom-select left" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                所有權人數
                                            </button>
                                            <div class="dropdown-menu">
                                                <form class="p3 pp">
                                                    <div class="pp2 row v5">
                                                        <input type="" class="form-control col-sm-2" placeholder="0" v-model="searchForm.land.condition.ownershipNumLowerLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">人-</label>
                                                        <input type="" class="form-control col-sm-2" placeholder="0" v-model="searchForm.land.condition.ownershipNumUpperLimit">
                                                        <label class="col-form-label la1" for="edit-text-name-id">人</label>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row row-cols-auto row1">
                                    <label class="col-form-label w-80 text-center1" for="edit-text-name-id">其他設定</label>
                                    <!--他項標記-->
                                    <div class="w-200">
                                        <select id="" class="form-select custom-select col-sm-12 w-10" v-model="searchForm.land.other.otherRemark">
                                            <option :value="null">他項標記</option>
                                            <option :value="idx" v-for="(i, idx) in otherRemarkList">(( i ))</option>
                                        </select>
                                    </div>
                                    <!--限制登記-->
                                    <div class="w-200">
                                        <select class="form-select custom-select col-sm-12 w-10" v-model="searchForm.land.other.restrictedRegistration">
                                            <option :value="null">限制登記</option>
                                            <option :value="idx+1" v-for="(i, idx) in restrictedRegistrationList">(( i ))</option>
                                        </select>
                                    </div>
                                    <div class="w-200 d-none">
                                        <!-- @@@@ -->
                                        <div class="dropdown">
                                            <button class="btn dropdown-toggle  custom-select left" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                lbkey
                                            </button>
                                            <div class="dropdown-menu">
                                                <form class="p3 pp row">
                                                    <div class="col-sm-6">
                                                        <select
                                                            class="form-control custom-select col-sm-12 w-10">
                                                            <option value="DF" selected>單筆</option>
                                                            <option value="LG">多筆</option>
                                                            <option value="SM">區間</option>
                                                        </select>
                                                    </div>
                                                    <div class="row v4">
                                                        <input type="" class="form-control col-sm-5 v2"
                                                            placeholder="起">
                                                        <label class="col-form-label la1" for="edit-text-name-id">～</label>
                                                        <input type="" class="form-control col-sm-5 v2"
                                                            placeholder="迄">
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="showResult">
                        <div class="a01">
                        <ul class="nav nav-pills mb-3 p-tab" id="pills-tab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active sbtn1" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab"
                                    aria-controls="pills-home" aria-selected="true">
                                    <svg class="svg01" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
                                        fill="#FFFFFF">
                                        <path d="M0 0h24v24H0z" fill="none" />
                                        <path
                                            d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
                                    </svg>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link sbtn2" id="pills-profile-tabs" data-toggle="pill" href="#pills-profile" role="tab"
                                    aria-controls="pills-profile" aria-selected="false">
                                    <svg class="svg02" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px"
                                        fill="#FFFFFF">
                                        <path d="M0 0h24v24H0z" fill="none" />
                                        <path
                                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                    </svg>
                                </a>
                            </li>
                        </ul>
                        <div class="h3" style="width: calc(100% - 150px);">
                            <template v-for="(op, opIdx) in getSearchOptionsList">
                                <span class="grey" v-if="opIdx">+</span> (( op ))
                            </template>
                        </div>
                        </div>
                        <div class="tab-content width2" id="pills-tabContent">
                            <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                                <div class="row mntable">
                                    <table  id="mytable" cellspacing="0" class=" table1 ttable table-bordered table-fixed-header">
                                        <thead class="header">
                                            <tr>
                                                <th role="button" @click="sortf($event, searchRes, '0.city_name')" scope="col" nowrap="nowrap" style="white-space:nowrap;" class="br1">縣市</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.area_name')" scope="col"  nowrap="nowrap" style="white-space:nowrap;">行政區</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.region_name')" scope="col" nowrap="nowrap" style="white-space:nowrap;">段小段</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.lno')" scope="col" nowrap="nowrap" style="white-space:nowrap;">地號</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.national_land_zone')" scope="col"  nowrap="nowrap" style="white-space:nowrap;">國土分區</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.land_zone')" scope="col" class="left">使用分區</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.urban_name')" scope="col" nowrap="nowrap" style="white-space:nowrap;" class="left">使用地類別(計畫案名)</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.land_area')" scope="col"  nowrap="nowrap" style="white-space:nowrap;">土地面積(坪)</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.land_notice_value')" scope="col" style="width:7%">公告現值</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.total_vp')" scope="col"  nowrap="nowrap" style="white-space:nowrap;">總公告</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.build_num')" scope="col" nowrap="nowrap" style="white-space:nowrap;">地上建物</th>
                                                <th role="button" @click="sortf($event, searchRes, '0.owner_type')" scope="col" nowrap="nowrap" style="white-space:nowrap;">權屬種類</th>
                                                <th role="button" @click="sortf($event, searchRes, 'length')" scope="col" nowrap="nowrap" style="white-space:nowrap;">所有權人</th>
                                                <th role="button" scope="col" nowrap="nowrap" style="white-space:nowrap;" class="br2">功能</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-body">
                                            <tr class="tab-content" v-if="loading">
                                                <td class="p-4" colspan="14">
                                                    <div class="loadingData">
                                                        <span></span>
                                                        <span></span>
                                                        <span></span>
                                                        <span></span>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="tab-content" v-else-if="!searchResBox.length">
                                                <td class="p-4" colspan="14">
                                                    <img style="height:217px;" src="/static/images/nodata.svg">
                                                    <h6 style="position: relative; margin-top: 3rem;" v-if="serverError">資料筆數過多，請縮小範圍重新查詢！</h6>
                                                    <h6 style="position: relative; margin-top: 3rem;" v-else>查無資料</h6>
                                                </td>
                                            </tr>
                                            <template v-for="(data, dataIdx) in searchResBox" class="tablebg1">
                                                <tr data-node="treetable-1">
                                                    <td class="td-left" data="縣市" nowrap="nowrap" style="white-space:nowrap;">
                                                        <p>(( data?.[0]?.city_name || '(空白)' ))</p>
                                                    </td>
                                                    <td data="行政區">
                                                        <p>(( data?.[0]?.area_name || '(空白)' ))</p>
                                                    </td>
                                                    <td data="段小段" nowrap="nowrap" style="white-space:nowrap;">
                                                        <p>(( data?.[0]?.region_name || '(空白)' ))</p>
                                                    </td>
                                                    <td data="地號" nowrap="nowrap" style="white-space:nowrap;" class="fw500">
                                                        <div class="row">
                                                            <p class="col">
                                                                <a v-if="data?.[0].is_valid" :href="'#' + data?.[0].region_name + data?.[0].lno" data-toggle="collapse">(( data?.[0]?.lno || '' ))</a>
                                                                <span v-else>(( data?.[0]?.lno || '' ))</span>
                                                                <img role="button" @click="showMap(data?.[0]?.point, data?.[0]?.polygon)" src="/static/images/map.png" class="map">
                                                            </p>
                                                        </div>
                                                    </td>
                                                    <td data="國土分區">
                                                        <p>(( data?.[0]?.national_land_zone || '' ))</p>
                                                    </td>
                                                    <td data="使用分區"class="left">
                                                        <p>(( data?.[0]?.land_zone || '(空白)' ))</p>
                                                    </td>
                                                    <td data="使用地類別(計畫案名)"class="left">
                                                        <p>(( data?.[0]?.urban_name || '(空白)' ))</p>
                                                    </td>
                                                    <td data="土地面積">
                                                        <p>(( (data?.[0]?.land_area / 3.30579).round(2) || '' ))</p>
                                                    </td>
                                                    <td data="公告現值" nowrap="nowrap" style="white-space:nowrap;">
                                                        <p>(( data?.[0]?.land_notice_value?.format() || '' ))</p>
                                                    </td>
                                                    <td data="總公告" nowrap="nowrap" style="white-space:nowrap;">
                                                        <p>(( data?.[0]?.total_vp?.chUnit(1, 2) || '' ))</p>
                                                    </td>
                                                    <td data="地上建物" nowrap="nowrap" style="white-space:nowrap;" nowrap="nowrap" style="white-space:nowrap;">
                                                        <p>(( data?.[0]?.build_num || '' ))</p>
                                                    </td>
                                                    <td data="權屬種類" nowrap="nowrap" style="white-space:nowrap;" nowrap="nowrap" style="white-space:nowrap;">
                                                        <p>(( data?.[0]?.owner_type || '' ))</p>
                                                    </td>
                                                    <td data="所有權人" nowrap="nowrap" style="white-space:nowrap;" nowrap="nowrap" style="white-space:nowrap;">
                                                        <p>(( data.length || 0 ))</p>
                                                    </td>
                                                    <td  class="td-right" data="功能" nowrap="nowrap" style="white-space:nowrap;" nowrap="nowrap" style="white-space:nowrap;">
                                                        <button class="btn btn-sm btn-success mr-2" @click="get_recno_list(data?.[0]?.lno, data?.[0]?.recno_list)" :disabled="!data?.[0]?.recno_list?.length">查實價</button>
                                                        <a :href="'/v_search/pdf_download/' + data?.[0]?.pdf_token" target="_blank" class="btn btn-sm btn-secondary" :disabled="!data?.[0]?.pdf_token">謄本下載</a>
                                                    </td>
                                                </tr>
                                                <tr :id="data?.[0].region_name + data?.[0].lno" class="collapse cell-1 row-child tablebg2">
                                                    <td colspan="15" class="cc2">
                                                        <table class="table3">
                                                            <thead class="header2">
                                                                <tr>
                                                                    <th role="button" @click="sortf($event, data, 'regno')"  nowrap="nowrap" style="white-space:nowrap;" class="br1">登記次序</th>
                                                                    <th role="button" @click="sortf($event, data, 'reg_date_str')" nowrap="nowrap" style="white-space:nowrap;">登記日期</th>
                                                                    <th role="button" @click="sortf($event, data, 'reg_reason_str')" nowrap="nowrap" style="white-space:nowrap;">登記原因</th>
                                                                    <th role="button" @click="sortf($event, data, 'name')" nowrap="nowrap" style="white-space:nowrap;">所有權人</th>
                                                                    <th role="button" @click="sortf($event, data, 'uid')" nowrap="nowrap" style="white-space:nowrap;">統一編號</th>
                                                                    <th role="button" @click="sortf($event, data, 'address_re')">住址</th>
                                                                    <th role="button" @click="sortf($event, data, 'bday')" nowrap="nowrap" style="white-space:nowrap;">出生日期</th>
                                                                    <th role="button" @click="sortf($event, data, 'right_str')" nowrap="nowrap" style="white-space:nowrap;">權利範圍</th>
                                                                    <th role="button" @click="sortf($event, data, 'shared_size')" nowrap="nowrap" style="white-space:nowrap;">持分面積(平方公尺)</th>
                                                                    <th role="button" @click="sortf($event, data, 'shared_size')" nowrap="nowrap" style="white-space:nowrap;">持分坪數</th>
                                                                    <th role="button" @click="sortf($event, data, 'shared_value')" nowrap="nowrap" style="white-space:nowrap;">持分現值</th>
                                                                    <th role="button" @click="sortf($event, data, 'creditors_rights')" class="br2" style="text-align:left;">他項權利(其他註記)</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr v-for="line in data">
                                                                    <td data="登記次序">(( line.regno || '' ))</td>
                                                                    <td data="登記日期"nowrap="nowrap" style="white-space:nowrap;">(( line.reg_date_str || '' ))</td>
                                                                    <td data="登記原因">(( line.reg_reason_str || '()' ))</td>
                                                                    <td data="所有權人">(( line.name || '' ))</td>
                                                                    <td data="統一編號">(( line.uid || '' ))</td>
                                                                    <td data="住址" class="left">(( line.address_re || '' ))</td>
                                                                    <td data="出生日期">(( line.bday || '' ))</td>
                                                                    <td data="權利範圍">(( line.right_str || '' ))</td>
                                                                    <td data="持分面積(平方公尺)">(( line.shared_size || '' ))</td>
                                                                    <td data="持分坪數">(( (line.shared_size / 3.30579).round(2) || '' ))</td>
                                                                    <td data="持分現值">(( line.shared_value?.chUnit(1, 2) || '' ))</td>
                                                                    <td data="他項權利(其他註記)"  style="text-align:left;">
                                                                        <p v-for="person in line.creditors_rights">(( person ))</p>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="footer1">
                                    <div class="row row8">
                                        <div class="input-group">
                                            <span class="input-group-text border-0" style="background-color: #f5f5f5;">每頁：</span>
                                            <select class="custom-select" v-model="onepageNum"><option v-for="i in pageNumList" :value="i">((i))</option></select>
                                            <span class="input-group-text border-0" style="background-color: #f5f5f5;">筆，共(( searchRes.length ))筆</span>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm">
                                            <nav aria-label="Page navigation example">
                                                <ul class="pagination">
                                                    <li class="page-item">
                                                        <span id="page-link3" class="page-link" @click="nowPage--">上一頁</span>
                                                        <span id="page-link1" class="page-link" @click="nowPage--"><</span>
                                                    </li>
                                                    <li class="page-item" :class="{active:nowPage==startPageBtn+i}" v-for="i in 9..minmax(1,totalPage)" @click="nowPage=startPageBtn+i">
                                                        <span class="page-link">(( startPageBtn+i ))</span>
                                                    </li>
                                                    <li class="page-item">
                                                        <span id="page-link4" class="page-link" @click="nowPage++">下一頁</span>
                                                        <span id="page-link2" class="page-link" @click="nowPage++">></span>
                                                    </li>
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
        
                            <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                                <div class="row mntable">
                                    <table class="table1 table-expandable">
                                        <thead class="header">
                                            <tr class="tabletop">
                                                <th role="button" @click="sortf($event, person_searchRes, '0.name')" scope="col" nowrap="nowrap" style="white-space:nowrap;" class="br1">所有權人</th>
                                                <th role="button" @click="sortf($event, person_searchRes, '0.uid')" scope="col" style="width:10%;">統一編號</th>
                                                <th role="button" @click="sortf($event, person_searchRes, '0.address_re')" scope="col" style="width:25%;">戶籍地址</th>
                                                <th role="button" @click="sortf($event, person_searchRes, '0.bday')" scope="col" style="width:5;">出生日期</th>
                                                <th role="button" @click="sortf($event, person_searchRes, 'length')" scope="col" style="width:10%;">土地總筆數</th>
                                                <th role="button" @click="sortf($event, person_searchRes, 'shared_size_t')" scope="col" style="width:5%;">持分總坪數</th>
                                                <th role="button" @click="sortf($event, person_searchRes, 'shared_value_t')" scope="col" style="width:5%;">持分總現值</th>
                                                <th role="button" @click="sortf($event, person_searchRes, '0.$電話')" scope="col" style="width:5%;">電話</th>
                                                <th role="button" @click="sortf($event, person_searchRes, '0.$所有權註記')" scope="col" style="width:10%;">所有權註記</th>
                                                <th role="button" @click="sortf($event, person_searchRes, '0.$身份標籤')" scope="col" style="width:10%;" class="br2">身份標籤</th>
                                            </tr>
                                        </thead>
                                        <tbody class="table-body">
                                            <tr class="tab-content" v-if="loading">
                                                <td class="p-4" colspan="11">
                                                    <div class="loadingData">
                                                        <span></span>
                                                        <span></span>
                                                        <span></span>
                                                        <span></span>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="tab-content" v-else-if="!person_searchResBox.length">
                                                <td class="p-4" colspan="14">
                                                    <img style="height:217px;" src="/static/images/nodata.svg">
                                                    <h6 style="position: relative; margin-top: 3rem;" v-if="serverError">資料筆數過多，請縮小範圍重新查詢！</h6>
                                                    <h6 style="position: relative; margin-top: 3rem;" v-else>查無資料</h6>
                                                </td>
                                            </tr>
                                            <template v-for="(data, dataIdx) in person_searchResBox">
                                                <tr data-node="treetable-1">
                                                    <td data="所有權人" nowrap="nowrap" class="fw500" style="white-space:nowrap;text-align: left;">
                                                        <p class="pstyle"><a :href="'#' + data._key" data-toggle="collapse">(( data?.[0]?.name || '' ))</a></p>
                                                    </td>
                                                    <td data="統一編號">
                                                        <p>(( data?.[0]?.uid || '' ))</p>
                                                    </td>
                                                    <td data="戶籍地址" class="left">
                                                        <p>(( data?.[0]?.address_re || '(空白)' ))</p>
                                                    </td>
                                                    <td data="出生日期">
                                                        <p>(( data?.[0]?.bday || '' ))</p>
                                                    </td>
                                                    <td data="土地總筆數">
                                                        <p>(( data?.length || '' ))</p>
                                                    </td>
                                                    <td data="持分總坪數">
                                                        <p>(( data.shared_size_t ))</p>
                                                    </td>
                                                    <td data="持分總現值">
                                                        <p>(( data.shared_value_t ))</p>
                                                    </td>
                                                    <td data="電話">
                                                        <p v-for="ph in data?.[0]?.phone">(( ph ))</p>
                                                    </td>
                                                    <td data="所有權註記">
                                                        <p>(( data?.[0]?.$所有權註記 || '' ))</p>
                                                    </td>
                                                    <td data="身份標籤">
                                                        <p>(( data?.[0]?.uid_tag || '' ))</p>
                                                    </td>
                                                </tr>
                                                <tr :id="data._key" class="collapse cell-1 row-child tablebg2">
                                                    <td colspan="15" class="cc2">
                                                        <table class="table3">
                                                            <thead class="header2">
                                                                <tr>
                                                                    <th role="button" @click="sortf($event, data, 'city_name')"  nowrap="nowrap" style="white-space:nowrap;" class="br1">縣市</th>
                                                                    <th role="button" @click="sortf($event, data, 'area_name')">行政區</th>
                                                                    <th role="button" @click="sortf($event, data, 'region_name')" nowrap="nowrap" style="white-space:nowrap;">段小段</th>
                                                                    <th role="button" @click="sortf($event, data, 'lno')" nowrap="nowrap" style="white-space:nowrap;">地號</th>
                                                                    <th role="button" @click="sortf($event, data, 'regno')">登記次序</th>
                                                                    <th role="button" @click="sortf($event, data, 'reg_date_str')" nowrap="nowrap" style="white-space:nowrap;">登記日期</th>
                                                                    <th role="button" @click="sortf($event, data, 'reg_reason_str')">登記原因</th>
                                                                    <th role="button" @click="sortf($event, data, 'land_area')">土地面積(坪)</th>
                                                                    <th role="button" @click="sortf($event, data, 'land_notice_value')">公告現值</th>
                                                                    <th role="button" @click="sortf($event, data, 'right_str')">權利範圍</th>
                                                                    <th role="button" @click="sortf($event, data, 'shared_size')">持分坪數</th>
                                                                    <th role="button" @click="sortf($event, data, 'present_value')">持分現值</th>
                                                                    <th role="button" @click="sortf($event, data, 'build_num')">地上建物筆數</th>
                                                                    <th role="button" @click="sortf($event, data, 'creditors_rights')" class="br2"  style="text-align:left;">他項權利(其他註記)</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr v-for="line in data">
                                                                    <td data="縣市" nowrap="nowrap" style="white-space:nowrap;">(( line.city_name || '' ))</td>
                                                                    <td data="行政區">(( line.area_name || '' ))</td>
                                                                    <td data="段小段" nowrap="nowrap" style="white-space:nowrap;">(( line.region_name || '' ))</td>
                                                                    <td data="地號" nowrap="nowrap" style="white-space:nowrap;">
                                                                        (( line.lno || '' ))
                                                                        <img role="button" @click="showMap(line?.point, line?.polygon)" src="/static/images/map.png" class="map">
                                                                    </td>
                                                                    <td data="登記次序">(( line.regno || '' ))</td>
                                                                    <td data="登記日期" nowrap="nowrap" style="white-space:nowrap;">(( line.reg_date_str || '' ))</td>
                                                                    <td data="登記原因">(( line.reg_reason_str || '' ))</td>
                                                                    <td data="土地面積">(( (line.land_area / 3.30579).round(2) || '' ))</td>
                                                                    <td data="公告現值">(( line.land_notice_value?.format() || '' ))</td>
                                                                    <td data="權利範圍">(( line.right_str || '' ))</td>
                                                                    <td data="持分坪數">(( (line.shared_size / 3.30579).round(2) || '' ))</td>
                                                                    <td data="持分現值">(( line.present_value?.chUnit(1, 2) || '' ))</td>
                                                                    <td data="地上建物筆數">(( line.build_num || '' ))</td>
                                                                    <td data="他項權利(其他註記)"  style="text-align:left;">
                                                                        <p v-for="person in line.creditors_rights">(( person ))</p>
                                                                    </td>
                                                                </tr>
                                                                <tr v-if="!data.personal_property && data?.[0]?.owner_type != '公法人'">
                                                                    <td colspan="14" class="text-left">
                                                                        <button class="btn btn-sm btn-primary" @click="personal_property(data.key, dataIdx)">查詢總歸戶</button>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="footer1">
                                    <div class="row">
                                        <div class="input-group">
                                            <span class="input-group-text border-0" style="background-color: #f5f5f5;">每頁：</span>
                                            <select class="custom-select" v-model="person_onepageNum"><option v-for="i in person_pageNumList" :value="i">((i))</option></select>
                                            <span class="input-group-text border-0" style="background-color: #f5f5f5;">筆，共(( person_searchRes.length ))筆</span>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm">
                                            <nav aria-label="Page navigation example">
                                                <ul class="pagination">
                                                    <li class="page-item">
                                                        <span class="page-link" @click="person_nowPage--">上一頁</span>
                                                    </li>
                                                    <li class="page-item" :class="{active:person_nowPage==person_startPageBtn+i}" v-for="i in 9..minmax(1,person_totalPage)" @click="person_nowPage=person_startPageBtn+i">
                                                        <span class="page-link">(( person_startPageBtn+i ))</span>
                                                    </li>
                                                    <li class="page-item">
                                                        <span class="page-link" @click="person_nowPage++">下一頁</span>
                                                    </li>
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            

            <div v-if="!showResult">
                <div class="row bg1">
                    <div class="col-sm-6 d-flex1 bgrwD">
                        <div class="align-self-center">
                            <h1 class="font-weight-bold mb-3">輕鬆幫您找出土地持有人</h1>
                            <h4 class="">搜尋土地開發範圍，輕鬆幫您找出土地持有人相關資訊</br>
                                幫助您精準鎖定關係人進一步推進成交！</h4>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <!--img src="/static/images/slogan.png"-->
                    </div>
                </div>
                <div class="row bg3">
                    <div class="col-sm-4">
                        <div class="bg2 justify-content-between">
                            <div class="bg4 align-self-center px-2">設定搜尋範圍</div>
                            <img class="align-self-start" src="/static/images/step0.png">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="bg2 justify-content-between">
                            <div class="bg5 align-self-center px-2">查看開發範圍</div>
                            <img class="align-self-start" src="/static/images/step1.png">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="bg2 justify-content-between">
                            <div class="bg6 align-self-center px-2">取得持有人情報</div>
                            <img class="align-self-start" src="/static/images/step2.png">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% endblock %}
    {% block script %}
    <script>
        var ms = [];
        const baseapp = Vue.createApp({
            delimiters: ['((', '))'],
            data() {
                return {
                    ownerShopList: {
                        natural:"自然人",
                        private:"私法人",
                        public:"公法人",
                        non_public:"非公有",
                        partially_public:"部分公有"
                    },
                    country_list:{
                        0: '不拘',
                        1: '本國人',
                        2: '外國人或無國籍人',
                        3: '取得國籍之外國人',
                        4: '原無戶籍國民',
                        5: '原港澳人民',
                        6: '原大陸人民',
                    },
                    age_range_list: {
                        0: '不拘',
                        1: '20-29歲',
                        2: '30-39歲',
                        3: '40-49歲',
                        4: '50-59歲',
                        5: '60-69歲',
                        6: '70-79歲',
                    },
                    areaTypeList: ["不拘", "總面積", "持分面積", "平均持分"],
                    inCity: ['住宅區', '工業區', '商業區', '農業區', '風景區', '別墅區', '林業區', '文教區', '水岸發展區', '水域', '行水區', '行政區', '防風林區', '其他使用分區', '服務區', '河川區', '保存區', '保護區', '活動區', '倉庫區', '旅館區', '海濱浴場區', '動植物園區', '國家公園區', '眺望區', '野餐區', '魚塭區', '景觀區', '溫泉區', '葬儀業區', '遊樂區', '遊憩區', '漁業區', '營區', '露營區', '體育運動區', '鹽田區區', '觀光農場區'],
                    outCity: ['特定農業區', '一般農業區', '工業區', '鄉村區', '森林區', '山坡地保護區', '風景區', '國家公園區', '河川區', '海域區', '其他使用區或特定專區'],
                    outCity2: ['甲種建築用地', '乙種建築用地', '丙種建築用地', '丁種建築用地', '牧農用地', '林業用地', '養殖用地', '鹽業用地', '礦業用地', '窯業用地', '交通用地', '水利用地', '遊憩用地', '古蹟保存用地', '生態保護用地', '國土保安用地', '殯葬用地', '海域用地', '特定目的事業用地'],
                    national_land_zoneList: ['不拘', '城一', '城二之一', '城二之二', '城二之三', '城三', '農一', '農二', '農三', '農四', '國一', '國二', '國三', '國四', '海一之一', '海一之二', '海一之三', '海二', '海三', '未分類'],
                    landbuildList: ["不拘"],
                    registerReasonList: ["繼承", "贈與", "買賣", "交換", "重劃", "總登記", "分割", "調解", "拍賣", "信託", "合併", "其他"],
                    otherRemarkList: ["無設定", "私設", "銀行二胎", "銀行", "租賃", "公司", "政府機構"],
                    restrictedRegistrationList: ["預告登記", "查封登記", "假扣押登記", "假處分登記", "破產登記", "其他依法律所為禁止處分登記"],
                    cityList: { "A": "臺北市", "C": "基隆市", "F": "新北市", "H": "桃園市", "O": "新竹市", "J": "新竹縣", "B": "臺中市", "K": "苗栗縣", "N": "彰化縣", "M": "南投縣", "P": "雲林縣", "D": "臺南市", "E": "高雄市", "I": "嘉義市", "Q": "嘉義縣", "T": "屏東縣", "G": "宜蘭縣", "U": "花蓮縣", "V": "臺東縣",/* "X": "澎湖縣", "W": "金門縣", "Z": "連江縣" */},
                    areaList: {},
                    sectionList:{},
                    planList: {},
                    showResult: 0,
                    loading: 0,
                    serverError: 0,
                    getSearchOptionsList: [],

                    useSet: 0,
                    setOption: ["縣市區域", "持分", "道路用地", "公共設施保留地"],

                    sortOption: "",
                    sortPreElement: "",

                    pageNumList: [5, 10, 20, 50, 100],
                    onepageNum: 10,
                    startPageBtn: 0,
                    nowPage: 0,
                    totalPage: 1,
                    searchRes: [],
                    searchResBox: [],

                    person_pageNumList: [5, 10, 20, 50, 100],
                    person_onepageNum: 10,
                    person_startPageBtn: 0,
                    person_nowPage: 0,
                    person_totalPage: 1,
                    person_searchRes: [],
                    person_searchResBox: [],

                    searchFormOrig: {},
                    searchForm:{
                        land:{
                            "region": {
                                "city": null, // 縣市
                                "area": null, // 行政區
                                "plan": null, // 計劃案
                                "section": null, // 段小段
                                "includeInvalid": 0, //包含失效
                                "land_number": "", // 地號
                                "national_land_zone": [], // 國土分區
                                "landbuildLowerLimit": null,
                                "landbuildUpperLimit": null,
                            },
                            "condition": {
                                "registerReason": { // 登記原因

                                },
                                "ownership": { //權屬
                                    "natural": 0,
                                    "private": 0,
                                    "public": 0,
                                    "non_public": 0,
                                    "partially_public": 0
                                },
                                "ownershipType": null, // 權屬種類 公同共有那些
                                "ownershipNumLowerLimit": 0, // 所有權人數 下限
                                "ownershipNumUpperLimit": 0, // 所有權人數 上限
                                "areaType": 0, // 土地面積 總面積那些
                                "landAreaLowerLimit": 0, // 土地面積 下限
                                "landAreaUpperLimit": 0, // 土地面積 上限
                                "road_land": false, // 道路用地
                                "common_land": false, // 公共設施保留地
                                "inCity": {}, // 使用分區都內
                                "outCity": {}, // 使用分區都外 分區
                                "outCity2": {}, // 使用分區都外 地類別
                                "presentLowerLimit": 0, // 公告現值 下限
                                "presentUpperLimit": 0, // 公告現值 上限
                            },
                            "other": {
                                "otherRemark": null, // 他項標記
                                "restrictedRegistration": null, // 限制登記
                                "age_range": 0,    // 年齡範圍
                                "country": {},      // 國籍
                                "p_part_valueLowerLimit": "", // 個人持分總值 下限
                                "p_part_valueUpperLimit": "", // 個人持分總值 上限
                                "p_part_areaLowerLimit": "", // 個人持分總面積 下限
                                "p_part_areaUpperLimit": "", // 個人持分總面積 上限
                                "holding_period": "", // 持有年限
                                "holding_period_l": 0, // 持有年限 下限
                                "holding_period_u": 0, // 持有年限 上限
                            }
                        }
                    },
                }
            },
            methods: {
                logout(){
                    new HTTPreq("/v_search/logout/", "fd").geta().then(rcv => {
                        var res = supfnc.toJSON(rcv.result);
                        if(res.status == "OK"){
                            window.location.href = "/";
                        }
                    });
                },
                getArea(city){
                    var T = this;
                    this.searchForm.land.region.area = null;
                    this.searchForm.land.region.plan = null;
                    this.searchForm.land.region.section = null;
                    if(!city || this.areaList[city]) return;
                    new HTTPreq("/v_search/get_area/?city=" + city).geta().then((rcv) => {
                        var res = supfnc.toJSON(rcv.result), data = {};
                        for(var i in res){
                            data[city + "_" + res[i].area_code] = res[i].area_name;
                        }
                        T.areaList[city] = data;
                    });
                },
                getSection(area){
                    var T = this;
                    this.searchForm.land.region.section = null;
                    if(!area || this.sectionList[area]) return;
                    new HTTPreq("/v_search/get_region/?area=" + area.slice(2,4)+ "&city=" + area[0]).geta().then((rcv) => {
                        var res = supfnc.toJSON(rcv.result), data = {};
                        for(var i in res){
                            data[res[i].car_code] = res[i].region_name;
                        }
                        T.sectionList[area] = data;
                    });
                },
                getPlan(area){
                    var T = this;
                    this.searchForm.land.region.plan = null;
                    if(!area || this.planList[area]) return;
                    new HTTPreq("/v_search/get_plan_name/", "fd").posta({area:area}).then((rcv) => {
                        var res = supfnc.toJSON(rcv.result), data = {};
                        for(var i in res.plan_name){
                            data[res.plan_name[i]] = res.nick_name[i];
                        }
                        T.planList[area] = data;
                    });
                },
                serverSearch(){
                    if(this.loading) return;
                    var T = this, searchForm = this.searchForm.duplicate();
                    // if(!searchForm.land.region.city || !searchForm.land.region.area || (!searchForm.land.region.plan && !searchForm.land.region.section)) {
                    //     Swal.fire("請選擇至段小段或計劃案", "", "error")
                    //     return;
                    // }
                    
                    if(!searchForm.land.region.city || !searchForm.land.region.area) {
                        Swal.fire("請選擇縣市行政區", "", "error")
                        return;
                    }
                    switch(this.useSet){
                        case 0:
                            if(!searchForm.land.region.section && !searchForm.land.region.plan){
                                Swal.fire("請選擇段小段或計劃案", "", "error")
                                return;
                            }
                            break;
                    }
                    this.loading = 1;
                    this.showResult = 1;

                    T.searchRes = [];
                    T.person_searchRes = [];
                    T.searchResBox = [];
                    T.person_searchResBox = [];

                    searchForm.land.region.land_number = this.landbuildNumberFix(searchForm.land.region.land_number, "l").res.join(",");
                    searchForm.land.other.age_range = [parseInt(searchForm.land.other.age_range)]
                    searchForm.land.other.country = searchForm.land.other.country.reduce((a,e) => {a.push(parseInt(e)); return a;}, [])

                    T.getSearchOptionsList = T.getSearchOptions();
                    new HTTPreq("/v_search/get_search_responseV3/", "fd").setHeaders({'Authorization': 'token {{ user_token }}'}).posta({lbtype: "L", searchForm}).then((rcv) => {
                        T.loading = 0;
                        T.sortOption = "";
                        T.sortPreElement = "";

                        if(rcv.status == 200){
                            var res = supfnc.toJSON(rcv.result);
                            var land_data = res.land_data, owner_data = res.owner_data;

                            for(var i in land_data){
                                for(var j in land_data[i]){
                                    land_data[i][j].shared_value = land_data[i][j].land_notice_value * land_data[i][j].shared_size;
                                }
                                T.searchRes.push(land_data[i]);
                            }
                            T.totalPage = Math.ceil(T.searchRes.length / T.onepageNum);
                            T.nowPage = 0;
                            Vue.nextTick(()=>{T.nowPage = 1;});

                            var tmp = {}, shared_size_t, shared_value_t;
                            for(var i in owner_data){
                                shared_size_t = 0;
                                shared_value_t = 0;
                                for(var j in owner_data[i]){
                                    shared_size_t += owner_data[i][j].shared_size / 3.30579;
                                    shared_value_t += owner_data[i][j].present_value;
                                }
                                owner_data[i].shared_size_t = shared_size_t.round(2);
                                owner_data[i].shared_value_t = shared_value_t.chUnit(1, 2);
                                
                                owner_data[i]._key = "k" + i.replace(new RegExp("[~!@#$%^&*()?<>/\\\\]", "g"), "");
                                owner_data[i].key = i;
                                T.person_searchRes.push(owner_data[i]);
                            }
                            T.person_totalPage = Math.ceil(T.person_searchRes.length / T.person_onepageNum);
                            T.person_nowPage = 0;
                            Vue.nextTick(()=>{T.person_nowPage = 1;});

                            T.serverError = 0;
                        }
                        else{
                            T.serverError = 1;
                        }
                    });
                },
                landbuildNumberFix(str, lbtype){
                    lb = ["b", "build"].includes(lbtype.toLowerCase()) ? [5, 3] : [4, 4];
                    var lbnum = str.replace(new RegExp("\\s"), "g").split(","), sublbnum, tmp, next;
                    var ok = true, res = [];
                    for(var i in lbnum){
                        next = false;
                        sublbnum = lbnum[i].split("~");
                        if(!lbnum[i]) continue;
                        if(sublbnum.length > 2) {
                            ok = false;
                            continue;
                        }
                        for(var j in sublbnum){
                            if(sublbnum[j].match(new RegExp(`^\\d{1,${lb[0]}}(-\\d{0,${lb[1]}})?$`))){
                                
                                tmp = sublbnum[j].split("-");
                                if(tmp.length > 2) {
                                    ok = false;
                                    next = true;
                                    break;
                                }
                                tmp[0] = parseInt(tmp[0]).zfill(lb[0]);
                                tmp[1] = parseInt(tmp[1] || 0).zfill(lb[1]);
                                res.push(tmp.join("-"));
                            }
                            else {
                                ok = false;
                                next = true;
                            }
                        }
                        if(sublbnum.length == 2 && !next){
                            tmp = res.pop();
                            res[res.length - 1] = [res.last(), tmp].join("~");
                        }
                    }
                    return {ok: ok, res: res};
                },
                multipleSelect: function(route, value){
                    var tmp = route.split("."), T = this, d = this;
                    for(var i=0; i<tmp.length-1; i++){
                        if(d[tmp[i]]) d = d[tmp[i]];
                    }
                    d[tmp.last()] = value;
                },
                clearInOutCitty(){
                    this.searchForm.land.condition.inCity = {};
                    this.searchForm.land.condition.outCity = {};
                    this.searchForm.land.condition.outCity2 = {};
                },
                getSearchOptions(){
                    var r = [
                        this.cityList[this.searchForm.land.region.city],
                        this.areaList[this.searchForm.land.region.city]?.[this.searchForm.land.region.area],
                        this.sectionList[this.searchForm.land.region.area]?.[this.searchForm.land.region.section] || this.planList[this.searchForm.land.region.area]?.[this.searchForm.land.region.plan]
                    ], tmp;
                    
                    
                    // 地號
                    if(this.searchForm.land.region.land_number) r.push("地號" + (this.searchForm.land.region.includeInvalid ? " (包含失效資料)" : "") + this.searchForm.land.region.land_number);
                    // 權屬
                    tmp = this.searchForm.land.condition.ownership.reduce((a,e,i) => {if(e) a.push(this.ownerShopList[i]); return a;}, []);
                    if(tmp.length) r.push(tmp.join(" "));
                    // 公同共有
                    tmp = ["全部", "持分", "公同共有"].getV(this.searchForm.land.condition.ownershipType)
                    if(tmp) r.push("持分 " + tmp);
                    // 使用分區
                    tmp = [];
                    if(this.searchForm.land.condition.road_land) tmp.push("道路用地");
                    if(this.searchForm.land.condition.common_land) tmp.push("公共設施保留地");
                    tmp = [...tmp, ...this.searchForm.land.condition.inCity.reduce((a,e,i) => {if(e) a.push(i); return a;}, [])];
                    tmp = [...tmp, ...this.searchForm.land.condition.outCity.reduce((a,e,i) => {if(e) a.push(i); return a;}, [])];
                    tmp = [...tmp, ...this.searchForm.land.condition.outCity2.reduce((a,e,i) => {if(e) a.push(i); return a;}, [])];
                    if(tmp.length) r.push(tmp.join(" "));
                    // 登記原因
                    tmp = this.searchForm.land.condition.registerReason.reduce((a,e,i) => {if(e) a.push(this.registerReasonList[i-1]); return a;}, []);
                    for(var i in tmp) r.push(tmp[i] + "登記");
                    // 持有年限
                    tmp = JSON.parse(this.searchForm.land.other.holding_period);
                    if(tmp[0] == 0 && tmp[1] == 0){}
                    else if(tmp.length == 1) r.push("持有" + tmp[0]/12 + "年以上");
                    else if(tmp[0] == 0) r.push("持有" + tmp[1] % 12 ? tmp[1] + "個月內" : tmp[1]/12 + "年內");
                    else r.push("持有" + tmp[0]/12 + "年 ~ " + tmp[1]/12 + "年");
                    // 國土分區
                    tmp = this.searchForm.land.region.national_land_zone.reduce((a,e,i) => {if(e) a.push(this.national_land_zoneList[i]); return a;}, []);
                    if(tmp.length) r.push("國土" + tmp.join(" ") + "區");
                    // 土地面積
                    if(this.searchForm.land.condition.landAreaLowerLimit || this.searchForm.land.condition.landAreaUpperLimit){
                        r.push("土地面積 " + this.searchForm.land.condition.landAreaLowerLimit + "坪 ~ " + this.searchForm.land.condition.landAreaUpperLimit + "坪");
                    }
                    // 公告現值
                    if(this.searchForm.land.condition.presentLowerLimit || this.searchForm.land.condition.presentUpperLimit){
                        r.push("現值 " + this.searchForm.land.condition.presentLowerLimit + "萬 ~ " + this.searchForm.land.condition.presentUpperLimit + "萬");
                    }
                    // 個人持分總值
                    if(this.searchForm.land.other.p_part_valueLowerLimit || this.searchForm.land.other.p_part_valueUpperLimit){
                        r.push("持分總值 " + this.searchForm.land.other.p_part_valueLowerLimit + "萬 ~ " + this.searchForm.land.other.p_part_valueUpperLimit + "萬");
                    }
                    // 年齡區間
                    tmp = this.age_range_list.getV(this.searchForm.land.other.age_range);
                    if(tmp) r.push("年齡 " + tmp);
                    // 國籍
                    tmp = this.searchForm.land.other.country.reduce((a,e,i) => {if(e) a.push(this.country_list[i]); return a;}, []);
                    if(tmp.length) r.push("國籍 " + tmp.join(" "));
                    // 所有權人數
                    if(this.searchForm.land.condition.ownershipNumLowerLimit || this.searchForm.land.condition.ownershipNumUpperLimit){
                        r.push("所有權人數 " + this.searchForm.land.condition.ownershipNumLowerLimit + "人 ~ " + this.searchForm.land.condition.ownershipNumUpperLimit + "人");
                    }
                    // 他項標記
                    tmp = this.otherRemarkList.getV(this.searchForm.land.other.otherRemark);
                    if(tmp) r.push(tmp);
                    // 限制登記
                    tmp = this.restrictedRegistrationList.getV(this.searchForm.land.other.restrictedRegistration-1);
                    if(tmp) r.push(tmp);

                    return r.filter(x => x);
                },
                sortf($event, tar, rou, dire = 1){
                    if(this.sortOption == rou + dire) dire ^= 1;
                    this.sortOption = rou + dire;
                    
                    var iE;
                    if(this.sortPreElement) {
                        this.sortPreElement.classList.remove("fa-sort-up");
                        this.sortPreElement.classList.remove("fa-sort-down");
                    }

                    if($event.target.getElementsByClassName("sorticon").length == 0){
                        iE = supfnc.createElement("i", {class: "sorticon ml-1 font-weight-bold fa"});
                        $event.target.appendChild(iE);
                    }
                    else{
                        iE = $event.target.getElementsByClassName("sorticon")[0];
                    }

                    iE.classList.add(dire ? "fa-sort-up" : "fa-sort-down");
                    this.sortPreElement = iE;

                    var route = rou.split("."), T = this;
                    tar.sort((a,b)=>{
                        for(var i in route){
                            a = a?.[route[i]];
                            b = b?.[route[i]];
                        }
                        return (a < b ? 1 : -1) * (-1) ** dire;
                    });
                    this.selectPage(1);
                    this.person_selectPage(1);
                },
                selectPage(nV, oV){
                    var data;
                    this.nowPage = nV.minmax(1, this.totalPage);
                    this.startPageBtn = (this.nowPage-4).minmax(1, Math.max(this.totalPage-8, 1)) - 1;
                    this.searchResBox.length = 0;
                    for(var i=0; i<this.onepageNum; i++){
                        data = this.searchRes[(nV-1) * this.onepageNum + i];
                        if(!data) break;
                        this.searchResBox.push(data);
                    }
                },
                person_selectPage(nV, oV){
                    var data;
                    this.person_nowPage = nV.minmax(1, this.person_totalPage);
                    this.person_startPageBtn = (this.person_nowPage-4).minmax(1, Math.max(this.person_totalPage-8, 1)) - 1;
                    this.person_searchResBox.length = 0;
                    for(var i=0; i<this.person_onepageNum; i++){
                        data = this.person_searchRes[(nV-1) * this.person_onepageNum + i];
                        if(!data) break;
                        this.person_searchResBox.push(data);
                    }
                },
                personal_property(key, dataIdx){
                    var T = this;
                    new HTTPreq("/v_search/personal_property/", "fd").posta({key: key, lbtype: "L"}).then(rcv => {
                        var res = supfnc.toJSON(rcv.result);
                        if(res.status === "OK"){
                            T.person_searchResBox[dataIdx].personal_property = 1;
                            if(res.owner_data.length){
                                T.person_searchResBox[dataIdx].length = 0;
                                var shared_size_t = 0, shared_value_t = 0;
                                for(var i in res.owner_data){
                                    shared_size_t += res.owner_data[i].shared_size / 3.30579;
                                    shared_value_t += res.owner_data[i].present_value;
                                    T.person_searchResBox[dataIdx].push(res.owner_data[i]);
                                    T.person_searchResBox[dataIdx].shared_size_t = shared_size_t.round(2);
                                    T.person_searchResBox[dataIdx].shared_value_t = shared_value_t.chUnit(1, 2);
                                }
                            }
                        }
                    });
                },
                setForm(index){
                    this.useSet = index;
                    this.searchForm = this.searchFormOrig.duplicate();
                    switch(index){
                        case 0:
                            this.searchForm.land.condition.ownership.natural = true;
                            break;
                        case 1:
                            this.searchForm.land.condition.ownershipType = 0;
                            this.searchForm.land.condition.ownership.natural = true;
                            break;
                        case 2:
                            this.searchForm.land.condition.road_land = true;
                            this.searchForm.land.condition.ownership.natural = true;
                            break;
                        case 3:
                            this.searchForm.land.condition.common_land = true;
                            this.searchForm.land.condition.ownership.natural = true;
                            break;
                    }
                },
                get_recno_list(lno, recno_list){
                    var titleOrder = ["tr_year_month", "total_price", "single_price", "total_area", "towers", "remark"];
                    var titleTrans = {
                        tr_year_month: "交易日期",
                        total_price: "總價(萬)",
                        single_price: "單價(萬/坪)",
                        total_area: "總面積(坪)",
                        towers: "交易標的",
                        remark: "備註",
                    }

                    var table = supfnc.createElement("table", {class: "table"});
                    var trh, td;

                    trh = supfnc.createElement("tr");
                    for(var j in titleOrder){
                        var title = titleOrder[j];
                        td = supfnc.createElement("th", {class: "text-nowrap"});
                        td.innerHTML = titleTrans[title];
                        trh.appendChild(td);
                    }
                    table.appendChild(trh);

                    for(var i in recno_list){
                        trh = supfnc.createElement("tr");
                        for(var j in titleOrder){
                            var title = titleOrder[j];
                            td = supfnc.createElement("td");
                            td.innerHTML = recno_list[i][title];
                            trh.appendChild(td);
                        }
                        table.appendChild(trh);
                    }
                    // console.log(recno_list, table)

                    Swal.fire({
                        title: "實價登錄 " + lno,
                        width: 800,
                        html: table.outerHTML,
                        confirmButtonText: "確認",
                        cancelButtonText: "關閉",
                        showCancelButton: false,
                    });
                },
                showMap(point, polygon){
                    Swal.fire({
                        title: "",
                        width: 600,
                        html: `<div id="googleMap" style="width: 500px; height: 500px;"></div`,
                    });
                    setTimeout(()=>{
                        initMap("googleMap", solve_multi_polygon(polygon));
                    }, 50);
                },
                bootstrapSubMenuToggle($event){
                    var isParent = supfnc.isParentElement($event.target, this.lastToogle);
                    var L = this.lastToogle?.length ?? 0;

                    if(!this.lastToogle?.length) {
                        this.lastToogle = [$event.target];
                        $event.target.nextSibling.classList.toggle('show');
                    }

                    for(var i=L-1 ;i>=0; i--){
                        if($event.target == this.lastToogle[i]){
                            $event.target.nextSibling.classList.toggle('show');
                            break;
                        }
                        else if(!supfnc.isParentElement($event.target.parentElement, this.lastToogle[i].parentElement)){
                            this.lastToogle[i].nextSibling?.classList?.toggle('show');
                            this.lastToogle.pop();
                            if(!i){
                                this.lastToogle.push($event.target);
                                $event.target.nextSibling.classList.toggle('show');
                            }
                        }
                        else{
                            this.lastToogle.push($event.target);
                            $event.target.nextSibling.classList.toggle('show');
                            break;
                        }
                    }
                },
            },
            mounted(){
                var T = this;
                ms[0] = this.multipleSelect;
                this.searchFormOrig = this.searchForm.duplicate();
                setTimeout(() => T.setForm(0), 50);
            },
            created(){},
            updated(){},
            beforeUpdate(){},
            watch:{
                nowPage:{
                    handler(nV, oV){
                        this.selectPage(nV, oV);
                    }
                },
                onepageNum:{
                    handler(nV, oV){
                        this.totalPage = Math.ceil(this.searchRes.length / nV);
                        this.selectPage(this.nowPage, oV);
                    }
                },
                person_nowPage:{
                    handler(nV, oV){
                        this.person_selectPage(nV, oV);
                    },
                },
                person_onepageNum:{
                    handler(nV, oV){
                        this.person_totalPage = Math.ceil(this.person_searchRes.length / nV);
                        this.person_selectPage(this.person_nowPage, oV);
                    },
                },
                "searchForm.land.other.holding_period_l":{
                    handler(nV, oV){
                        this.searchForm.land.other.holding_period = `[${nV*12},${this.searchForm.land.other.holding_period_u*12}]`;
                    },
                    immediate: true,
                },
                "searchForm.land.other.holding_period_u":{
                    handler(nV, oV){
                        this.searchForm.land.other.holding_period = `[${this.searchForm.land.other.holding_period_l*12},${nV*12}]`;
                    }
                },
            },
            computed:{
                searchFormText(){
                    var T = this, r = this.searchForm.duplicate();
                    r.land.condition.ownership = r.land.condition.ownership.reduce((a,e,i) => {if(e) a.push(T.ownerShopList[i]); return a;}, []).join("、") || "權屬";
                    r.land.condition.registerReason = r.land.condition.registerReason.reduce((a,e,i) => {if(e) a.push(T.registerReasonList[i-1]); return a;}, []).join("、") || "登記原因";
                    r.land.region.national_land_zone = r.land.region.national_land_zone.reduce((a,e,i) => {if(e) a.push(T.national_land_zoneList[i]); return a;}, []).join("、") || "國土區分";
                    r.land.other.country = r.land.other.country.reduce((a,e,i) => {if(e) a.push(T.country_list[i]); return a;}, []).join("、") || "國籍";
                    return r;
                }
            }
        });

        // test
        // new HTTPreq("/v_search/get_search_responseV3/", "fd").setHeaders({'Authorization': 'token a021bd4735ebec44a3564cea9390d91aadfdabff'}).posta({lbtype: "L", searchForm: vm.searchForm, fake_data: true}).then((rcv) => {
        //     var res = supfnc.toJSON(rcv.result);
        //     console.log(res);
        // });
    </script>
    <script>
        function get_pol(type, value) {
            var r = [], center = [0, 0];
            if (type == 'MULTIPOLYGON') {
                var tmp, totalL = 0;
                value = value.slice(15, value.length - 1).match(new RegExp("\\(\\([\\d\\.\\,\\s]+\\)\\)", "g"));
                // value = value.slice(15, value.length - 1).match(/\(\([\d\.\,\s]+\)\)/g);
                for (var i in value) {
                    tmp = get_pol('POLYGON', 'POLYGON ' + value[i]);
                    r[i] = tmp[0]
                    center[0] += tmp[1][0] * tmp[2];
                    center[1] += tmp[1][1] * tmp[2];
                    totalL += tmp[2];;
                }
                center[0] /= totalL;
                center[1] /= totalL;
                return [r, center];
            }
            else if (type == 'POLYGON') {
                value = value.slice(10,).replace('))', '').split(', ');
                for (var i in value) {
                    value[i] = value[i].split(' ');
                    r[i] = { lng: parseFloat(value[i][0]), lat: parseFloat(value[i][1]) };
                    center[0] += parseFloat(value[i][0]);
                    center[1] += parseFloat(value[i][1]);
                }
                center[0] /= value.length;
                center[1] /= value.length;
                return [r, center, value.length];
            }
            else{
                center = value.slice(7,value.length-1).split(" ");
                center[0] = parseFloat(center[0])
                center[1] = parseFloat(center[1])
                r = {lng: center[0], lat: center[1]};
                return [r, center, 1];
            }
        }

        function solve_multi_polygon(raw_data) {
            var r = {}, tmp, type = raw_data.match('MULTIPOLYGON') ? "MULTIPOLYGON" : raw_data.match('POLYGON') ? "POLYGON" : "POINT", max = {lng:0, lat:0}, min = {lng:999, lat:999}, tmp;
            tmp = get_pol(type, raw_data);
            r.polygon = tmp[0];
            r.center = { lng: tmp[1][0], lat: tmp[1][1] };
            r.type = type;
            if (type == "MULTIPOLYGON") {
                for(var i in r.polygon){
                    for(var j in r.polygon[i]){
                        if(r.polygon[i][j].lng > max.lng){max.lng = r.polygon[i][j].lng;}
                        else if(r.polygon[i][j].lng < min.lng){min.lng = r.polygon[i][j].lng;} 
                        if(r.polygon[i][j].lat > max.lat){max.lat = r.polygon[i][j].lat;}
                        else if(r.polygon[i][j].lat < min.lat){min.lat = r.polygon[i][j].lat;}
                    }
                }
            }
            else if (type == "POLYGON"){
                for(var i in r.polygon){
                    if(r.polygon[i].lng > max.lng){max.lng = r.polygon[i].lng;}
                    else if(r.polygon[i].lng < min.lng){min.lng = r.polygon[i].lng;} 
                    if(r.polygon[i].lat > max.lat){max.lat = r.polygon[i].lat;}
                    else if(r.polygon[i].lat < min.lat){min.lat = r.polygon[i].lat;}
                }
            }
            else{
                max.lat = min.lat = r.polygon.lat;
                max.lng = min.lng = r.polygon.lng;
            }
            r.range = {};
            r.range.lat = {max: max.lat, min: min.lat};
            r.range.lng = {max: max.lng, min: min.lng};
            r.zoom = Math.min(-Math.log2(Math.max(r.range.lng.max - r.range.lng.min, r.range.lat.max - r.range.lat.min)), 12);
            return r;
        }

        function initMap(divID, data) {
            if(!data) return;
            const map = new google.maps.Map(document.getElementById(divID), {
                zoom: Math.round(data.zoom * 2) - 2,
                // center: now_view.center,
                center: data.center,
                mapTypeId: "terrain",
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });
            if(data.type == "POINT"){
                const googleMapPopup = new google.maps.Marker({
                    position: data.polygon,
                    map: map,
                    title:'test'
                });
                googleMapPopup.setMap(map);
            }
            else{
                const googleMapPopup = new google.maps.Polygon({
                    paths: data.polygon,
                    strokeColor: "#FF0000",
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: "#FF0000",
                    fillOpacity: 0.35,
                });
                googleMapPopup.setMap(map);
            }
        }
    </script>
    <script>
        // $(document).ready(function(){
        //     $('.dropdown-submenu button.dropdown-toggle').on("click", function(e){
        //         $(this).next('ul').toggle();
        //         e.stopPropagation();
        //         e.preventDefault();
        //     });
        // });
        </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDL6b7ap8iH5-g_IhdwtluUwkWYcJbuRMU&libraries=&callback=initMap&v=weekly" async></script>
    {% endblock %}
</body>

</html>